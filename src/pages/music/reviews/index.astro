---
import BaseHead from "@/components/BaseHead.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { getCollection } from "astro:content";
import { ViewTransitions } from "astro:transitions";

export const prerender = true;

const songs = (await getCollection("songs")).sort((a, b) =>
  a.data.title.localeCompare(b.data.title),
);

// Format duration from ms to mm:ss
const formatDuration = (ms: number) => {
  const minutes = Math.floor(ms / 60000);
  const seconds = ((ms % 60000) / 1000).toFixed(0);
  return `${minutes}:${seconds.toString().padStart(2, "0")}`;
};
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead
      title="Music Reviews"
      description="AI-generated reviews of songs I'm listening to"
    />
    <ViewTransitions />
    <style>
      @media screen and (min-width: 1000px) {
        .reviews-list:has(.review-item:hover) .review-item:not(:hover) {
          opacity: 0.70;
        }
      }
    </style>
  </head>
  <body class="bg-white dark:bg-slate-900">
    <Header />
    <main
      class="bg-white relative shadow z-10 dark:bg-slate-900 dark:text-slate-200 min-h-screen"
    >
      <div class="max-w-screen-xl mx-auto px-4 py-8">
        <div class="mb-12">
          <h1
            class="text-5xl font-bold tracking-tight text-gray-900 dark:text-slate-100 md:text-6xl"
          >
            Music Reviews
          </h1>
          <p class="mt-4 text-xl text-gray-600 dark:text-slate-300 max-w-3xl">
            AI-generated reviews of songs I'm listening to. Each review is
            automatically created when I share a Spotify link, using ChatGPT to
            analyze the track's vibe, production, and emotional impact.
          </p>
          <p class="mt-4 has-links">
            <a
              href="/music"
              class="text-blue-600 dark:text-blue-400 hover:underline"
              >View my listening history</a
            >
          </p>
        </div>

        {
          songs.length === 0 ? (
            <div class="text-center py-12">
              <p class="text-gray-600 dark:text-slate-400 text-lg">
                No song reviews yet. Share a Spotify link in a PR to generate
                your first review!
              </p>
            </div>
          ) : (
            <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3 reviews-list lg:gap-12">
              {songs.map((song) => (
                <a
                  href={`/music/reviews/${song.slug}/`}
                  class="rounded-lg flex gap-4 review-item group transition-opacity duration-1000 ease-in-out"
                >
                  {song.data.albumArt && (
                    <div class="aspect-square rounded-full h-24 w-24 shrink-0 overflow-hidden lg:h-32 lg:w-32">
                      <img
                        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
                        src={song.data.albumArt}
                        alt={`Album art for ${song.data.album}`}
                      />
                    </div>
                  )}
                  <div class="flex flex-col justify-center">
                    <h2 class="text-md font-bold text-gray-900 dark:text-slate-100 group-hover:text-red-700 dark:group-hover:text-red-400 transition-colors">
                      {song.data.title}
                    </h2>
                    <p class="text-gray-600 text-sm dark:text-slate-400 mt-1">
                      {song.data.artist}
                    </p>
                  </div>
                </a>
              ))}
            </div>
          )
        }
      </div>
    </main>
    <Footer />
  </body>
</html>
